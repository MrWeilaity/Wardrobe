# MySQL 5.7 数据库配置说明

## 1. 安装 MySQL 5.7

### Windows
1. 下载 MySQL 5.7 安装包：https://dev.mysql.com/downloads/mysql/5.7.html
2. 运行安装程序并完成安装
3. 设置 root 密码为 `root`（或自定义密码）

### Mac
```bash
brew install mysql@5.7
brew services start mysql@5.7
```

### Linux (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install mysql-server-5.7
sudo systemctl start mysql
```

## 2. 创建数据库

登录 MySQL:
```bash
mysql -u root -p
```

执行以下 SQL 命令:
```sql
CREATE DATABASE wardrobe CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

或者直接执行提供的 schema.sql 文件:
```bash
mysql -u root -p < backend/src/main/resources/schema.sql
```

## 3. 配置数据库连接

数据库连接配置在 `backend/src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/wardrobe?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.jdbc.Driver
    username: root
    password: root
```

**重要**: 如果您的 MySQL 密码不是 `root`，请修改 `password` 字段。

## 4. 数据库表结构

系统会自动创建以下表：

### 核心表
- **users** - 用户表
- **user_roles** - 用户角色表
- **clothing** - 衣物表
- **clothing_tags** - 衣物标签表
- **outfits** - 穿搭方案表
- **outfit_clothing** - 穿搭与衣物关联表
- **travel_plans** - 旅行计划表
- **travel_clothing** - 旅行与衣物关联表

### 字符集
所有表使用 `utf8mb4` 字符集，支持中文和 Emoji。

## 5. 数据库备份

### 备份命令
```bash
mysqldump -u root -p wardrobe > wardrobe_backup.sql
```

### 恢复命令
```bash
mysql -u root -p wardrobe < wardrobe_backup.sql
```

## 6. 常见问题

### Q: 连接失败 "Access denied for user 'root'@'localhost'"
A: 检查密码是否正确，或在 application.yml 中修改用户名和密码。

### Q: 数据库不存在
A: 确保已创建 wardrobe 数据库：
```sql
CREATE DATABASE wardrobe CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### Q: 时区问题
A: URL 中已包含 `serverTimezone=Asia/Shanghai`，如需修改时区，请更改此参数。

### Q: SSL 警告
A: URL 中已设置 `useSSL=false`，这是开发环境的配置。生产环境建议启用 SSL。

## 7. 生产环境配置建议

生产环境建议使用以下配置：

```yaml
spring:
  datasource:
    url: jdbc:mysql://your-db-host:3306/wardrobe?useSSL=true&serverTimezone=Asia/Shanghai
    username: wardrobe_user
    password: <strong-password>
  jpa:
    hibernate:
      ddl-auto: validate  # 生产环境使用 validate 而不是 update
```

建议：
1. 使用专用数据库用户（非 root）
2. 设置强密码
3. 启用 SSL 连接
4. 定期备份数据库
5. 生产环境使用 `ddl-auto: validate` 避免自动修改表结构
