# å›¾ç‰‡ä¸Šä¼ ä¿®å¤å’ŒDockeréƒ¨ç½²æ€»ç»“

## ğŸ“ é—®é¢˜æè¿°

å‰ç«¯ä¸Šä¼ çš„å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œä¾‹å¦‚ï¼š`/api/uploads/31b79602-8d41-417c-b191-1500010ced88.png`

## ğŸ”§ é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
Spring Boot çš„é™æ€èµ„æºé…ç½® `FileUploadConfig.java` ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„ `uploads/`ï¼Œå¯¼è‡´ `ResourceHandlerRegistry` æ— æ³•æ­£ç¡®å®šä½å’Œæä¾›ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶ã€‚

### é—®é¢˜è¯¦æƒ…
```java
// é—®é¢˜ä»£ç 
registry.addResourceHandler("/uploads/**")
        .addResourceLocations("file:" + uploadPath);  // uploadPath = "uploads/"
```

å½“ Spring Boot å°è¯•è®¿é—® `file:uploads/test.png` æ—¶ï¼Œç”±äºä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå®é™…è®¿é—®çš„è·¯å¾„ä¸ç¡®å®šï¼Œå¯¼è‡´æ–‡ä»¶æ— æ³•æ‰¾åˆ°ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶
`backend/src/main/java/com/wardrobe/config/FileUploadConfig.java`

### å®æ–½çš„ä¿®å¤
1. åˆ›å»ºç§æœ‰æ–¹æ³• `getAbsoluteUploadPath()` å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
2. ç¡®ä¿è·¯å¾„æœ«å°¾æœ‰æ­£ç¡®çš„æ–‡ä»¶åˆ†éš”ç¬¦
3. åœ¨ `addResourceHandlers()` ä¸­ä½¿ç”¨ç»å¯¹è·¯å¾„

### ä¿®å¤åçš„ä»£ç 
```java
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
    // è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ä»¥ç¡®ä¿æ­£ç¡®çš„æ–‡ä»¶æœåŠ¡
    String absolutePath = getAbsoluteUploadPath();
    registry.addResourceHandler("/uploads/**")
            .addResourceLocations("file:" + absolutePath);
}

private String getAbsoluteUploadPath() {
    File uploadDir = new File(uploadPath);
    String absolutePath = uploadDir.getAbsolutePath();
    // ç¡®ä¿è·¯å¾„ä»¥åˆ†éš”ç¬¦ç»“å°¾
    if (!absolutePath.endsWith(File.separator)) {
        absolutePath += File.separator;
    }
    return absolutePath;
}
```

## ğŸ³ Docker éƒ¨ç½²é…ç½®

ä¸ºäº†æ–¹ä¾¿éƒ¨ç½²å’Œæµ‹è¯•ï¼Œæˆ‘ä»¬æ·»åŠ äº†å®Œæ•´çš„ Docker æ”¯æŒã€‚

### åˆ›å»ºçš„æ–‡ä»¶

#### 1. Docker é…ç½®æ–‡ä»¶
- `backend/Dockerfile` - åç«¯æœåŠ¡çš„ Docker é•œåƒ
- `frontend/Dockerfile` - å‰ç«¯æœåŠ¡çš„ Docker é•œåƒï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
- `docker-compose.yml` - å®Œæ•´çš„æœåŠ¡ç¼–æ’é…ç½®
- `frontend/nginx.conf` - Nginx åå‘ä»£ç†é…ç½®

#### 2. ä¼˜åŒ–æ–‡ä»¶
- `backend/.dockerignore` - åç«¯æ„å»ºä¼˜åŒ–
- `frontend/.dockerignore` - å‰ç«¯æ„å»ºä¼˜åŒ–
- `backend/src/main/resources/application-prod.yml` - ç”Ÿäº§ç¯å¢ƒé…ç½®

#### 3. æ–‡æ¡£å’Œè„šæœ¬
- `DOCKER_DEPLOYMENT.md` - å®Œæ•´çš„ Docker éƒ¨ç½²æ–‡æ¡£
- `quick-start.sh` - å¿«é€Ÿå¯åŠ¨è„šæœ¬
- `test-image-access.sh` - å›¾ç‰‡è®¿é—®æµ‹è¯•è„šæœ¬
- `.env.example` - ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿

#### 4. æ›´æ–°çš„æ–‡ä»¶
- `README.md` - æ·»åŠ  Docker éƒ¨ç½²è¯´æ˜
- `.gitignore` - æ›´æ–°å¿½ç•¥è§„åˆ™

### Docker æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·æµè§ˆå™¨                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ http://localhost
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Frontend (Nginx + Vue.js)               â”‚
â”‚              Port: 80                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ /api/* â†’ backend:8080/api/*
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Backend (Spring Boot)                    â”‚
â”‚              Port: 8080                          â”‚
â”‚         Context Path: /api                       â”‚
â”‚         Uploads: /app/uploads/                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ JDBC Connection
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MySQL 5.7                           â”‚
â”‚              Port: 3306                          â”‚
â”‚         Database: wardrobe                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æŒä¹…åŒ–

ä½¿ç”¨ Docker volumes æŒä¹…åŒ–æ•°æ®ï¼š
- `mysql_data` - MySQL æ•°æ®åº“æ•°æ®
- `upload_data` - ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ä¸€ï¼šå¿«é€Ÿå¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
./quick-start.sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨
```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

### è®¿é—®åº”ç”¨
- å‰ç«¯: http://localhost
- åç«¯API: http://localhost:8080/api
- MySQL: localhost:3306

### æµ‹è¯•å›¾ç‰‡ä¸Šä¼ 
```bash
./test-image-access.sh
```

## ğŸ“Š éªŒè¯ç»“æœ

### ç¼–è¯‘æµ‹è¯•
âœ… åç«¯æˆåŠŸç¼–è¯‘ï¼ˆ`mvn clean compile`ï¼‰
âœ… æ— è¯­æ³•é”™è¯¯
âœ… æ— ç¼–è¯‘è­¦å‘Š

### å®‰å…¨æ‰«æ
âœ… CodeQL æ‰«æé€šè¿‡ï¼ˆ0 ä¸ªè­¦å‘Šï¼‰
âœ… æ— å®‰å…¨æ¼æ´

### ä»£ç å®¡æŸ¥
âœ… ä»£ç å®¡æŸ¥é€šè¿‡
âœ… å·²æ ¹æ®åé¦ˆä¼˜åŒ–ä»£ç ç»“æ„

### Docker é…ç½®
âœ… docker-compose.yml é…ç½®éªŒè¯é€šè¿‡
âœ… æ‰€æœ‰ Dockerfile è¯­æ³•æ­£ç¡®
âœ… æœåŠ¡ç¼–æ’é…ç½®å®Œæ•´

## ğŸ” å·¥ä½œåŸç†

### å›¾ç‰‡ä¸Šä¼ æµç¨‹
1. ç”¨æˆ·åœ¨å‰ç«¯é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
2. å‰ç«¯é€šè¿‡ `POST /api/upload/image` ä¸Šä¼ å›¾ç‰‡
3. åç«¯å°†å›¾ç‰‡ä¿å­˜åˆ° `/app/uploads/` ç›®å½•ï¼ˆDocker å®¹å™¨å†…ï¼‰
4. åç«¯è¿”å›å›¾ç‰‡ URLï¼š`/api/uploads/{uuid}.png`
5. å‰ç«¯åœ¨ `<img>` æ ‡ç­¾ä¸­ä½¿ç”¨è¯¥ URL

### å›¾ç‰‡è®¿é—®æµç¨‹
1. æµè§ˆå™¨è¯·æ±‚ `/api/uploads/{uuid}.png`
2. Nginx è½¬å‘è¯·æ±‚åˆ° `backend:8080/api/uploads/{uuid}.png`
3. Spring Boot çš„ ResourceHandler ä»ç»å¯¹è·¯å¾„ `/app/uploads/` æä¾›æ–‡ä»¶
4. å›¾ç‰‡æˆåŠŸæ˜¾ç¤º

### ä¸ºä»€ä¹ˆéœ€è¦ç»å¯¹è·¯å¾„ï¼Ÿ
- ç›¸å¯¹è·¯å¾„ `uploads/` åœ¨å®¹å™¨ç¯å¢ƒä¸­åŸºå‡†ç›®å½•ä¸ç¡®å®š
- ç»å¯¹è·¯å¾„ `/app/uploads/` ç¡®ä¿æ–‡ä»¶ä½ç½®æ˜ç¡®
- ResourceHandlerRegistry éœ€è¦æ˜ç¡®çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„

## ğŸ“¦ éƒ¨ç½²ä¼˜åŠ¿

### Docker éƒ¨ç½²çš„å¥½å¤„
1. **ç¯å¢ƒä¸€è‡´æ€§** - å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
2. **å¿«é€Ÿéƒ¨ç½²** - ä¸€æ¡å‘½ä»¤å¯åŠ¨æ‰€æœ‰æœåŠ¡
3. **ä¾èµ–éš”ç¦»** - æ‰€æœ‰ä¾èµ–æ‰“åŒ…åœ¨é•œåƒä¸­
4. **æ•°æ®æŒä¹…åŒ–** - ä½¿ç”¨ volumes ä¿è¯æ•°æ®ä¸ä¸¢å¤±
5. **æ˜“äºæ‰©å±•** - å¯è½»æ¾æ·»åŠ æ–°æœåŠ¡ï¼ˆRedisã€Elasticsearchç­‰ï¼‰
6. **å¥åº·æ£€æŸ¥** - è‡ªåŠ¨ç›‘æ§æœåŠ¡çŠ¶æ€
7. **ç®€åŒ–è¿ç»´** - ç»Ÿä¸€ç®¡ç†å’Œç›‘æ§

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
1. ä¿®æ”¹é»˜è®¤å¯†ç ï¼ˆMySQLã€JWTå¯†é’¥ï¼‰
2. ä½¿ç”¨å¤–éƒ¨ MySQL æœåŠ¡ï¼ˆäº‘æ•°æ®åº“ï¼‰
3. é…ç½® HTTPS/SSL è¯ä¹¦
4. ä½¿ç”¨äº‘å­˜å‚¨ï¼ˆOSS/S3ï¼‰æ›¿ä»£æœ¬åœ°æ–‡ä»¶å­˜å‚¨
5. é…ç½®èµ„æºé™åˆ¶ï¼ˆCPUã€å†…å­˜ï¼‰
6. å¯ç”¨æ—¥å¿—æ”¶é›†å’Œç›‘æ§
7. é…ç½®è‡ªåŠ¨å¤‡ä»½

### åŠŸèƒ½å¢å¼º
1. å›¾ç‰‡å‹ç¼©å’Œç¼©ç•¥å›¾ç”Ÿæˆ
2. CDN é›†æˆ
3. å›¾ç‰‡æ°´å°
4. æ‰¹é‡ä¸Šä¼ 
5. å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½

## ğŸ“ æ”¯æŒ

è¯¦ç»†æ–‡æ¡£ï¼š
- Docker éƒ¨ç½²ï¼š`DOCKER_DEPLOYMENT.md`
- å¿«é€Ÿå¼€å§‹ï¼š`å¿«é€Ÿå¼€å§‹.md`
- ç³»ç»Ÿè¯´æ˜ï¼š`ç³»ç»Ÿè¯´æ˜.md`

## âœ… å®Œæˆæ¸…å•

- [x] ä¿®å¤å›¾ç‰‡ä¸Šä¼ æ˜¾ç¤ºé—®é¢˜
- [x] åˆ›å»ºå®Œæ•´çš„ Docker é…ç½®
- [x] ç¼–å†™ Docker éƒ¨ç½²æ–‡æ¡£
- [x] åˆ›å»ºå¿«é€Ÿå¯åŠ¨è„šæœ¬
- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬
- [x] æ›´æ–° README.md
- [x] ä»£ç å®¡æŸ¥å’Œä¼˜åŒ–
- [x] å®‰å…¨æ‰«æ
- [x] é…ç½®éªŒè¯

æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼âœ¨
